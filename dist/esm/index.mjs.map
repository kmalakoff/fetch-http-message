{"version":3,"file":"index.mjs","names":["blobToString","hasHeaders","Headers","hasBlob","Blob","hasBuffer","Buffer","hasURLSearchParams","URLSearchParams","isRequest","object","fetchHttpMessage","input","init","undefined","Error","url","method","toUpperCase","lines","headers","pair","entries","push","key","body","indexOf","String","toString","join"],"sources":["../../src/index.ts"],"sourcesContent":["import blobToString from './blobToString';\n\nexport interface HeadersObject {\n  [key: string]: string;\n}\n\n// https://github.com/node-fetch/node-fetch/blob/main/%40types/index.d.ts\nexport type HeadersInit = Headers | HeadersObject | Record<string, string> | Iterable<readonly [string, string]> | Iterable<Iterable<string>>;\nconst hasHeaders = typeof Headers !== 'undefined';\n\nexport type BodyInit = Blob | Buffer | URLSearchParams | string;\nconst hasBlob = typeof Blob !== 'undefined';\nconst hasBuffer = typeof Buffer !== 'undefined';\nconst hasURLSearchParams = typeof URLSearchParams !== 'undefined';\n\n// export type RequestRedirect = 'error' | 'follow' | 'manual';\nexport interface RequestInit {\n  body?: BodyInit | null;\n  headers?: HeadersInit;\n  method?: string;\n  // redirect?: RequestRedirect;\n}\n\nexport type RequestInfo = string | Request;\nexport interface Request {\n  readonly headers: Headers | HeadersObject;\n  readonly method: string;\n  // readonly redirect: RequestRedirect;\n  readonly url: string;\n}\n\nfunction isRequest(object) {\n  return typeof object === 'object';\n}\n\n/**\n * Generate an http message string using the fetch API\n *\n * @param input Fetch input\n * @param init Fetch init\n * @returns The http message string\n */\nexport default function fetchHttpMessage(input: RequestInfo, init?: RequestInit): string {\n  if (input === undefined) throw new Error('Input is expected');\n  if (init === undefined) init = {};\n\n  let url;\n  if (isRequest(input)) url = (input as Request).url;\n  else {\n    url = input as string;\n    input = {} as Request;\n  }\n\n  let method = init.method || (input as Request).method || 'GET';\n  method = method.toUpperCase();\n  const lines = [`${method} ${url} HTTP/1.1`];\n\n  const headers = init.headers || (input as Request).headers;\n  if (headers !== undefined) {\n    /* c8 ignore start */\n    if (hasHeaders && headers instanceof Headers) {\n      for (const pair of (headers as Headers).entries()) lines.push(`${pair[0]}: ${pair[1]}`);\n    } else {\n      /* c8 ignore stop */\n      for (const key in headers as HeadersObject) lines.push(`${key}: ${headers[key]}`);\n    }\n  }\n\n  const body = init.body;\n  if (body !== undefined) {\n    if (~['GET', 'HEAD'].indexOf(method)) throw new Error(`Option body not valid with method ${method}`);\n    /* c8 ignore start */\n    if (hasBlob && body instanceof Blob) {\n      lines.push('');\n      lines.push(blobToString(body));\n    } else if (\n      /* c8 ignore stop */\n      typeof body === 'string' ||\n      body instanceof String ||\n      /* c8 ignore start */\n      (hasBuffer && body instanceof Buffer) ||\n      (hasURLSearchParams && body instanceof URLSearchParams)\n      /* c8 ignore stop */\n    ) {\n      lines.push('');\n      lines.push(body.toString());\n    } else throw new Error('Option body should be convertible to a string');\n  }\n  return lines.join('\\r\\n');\n}\n"],"mappings":"OAAOA,Y;AAQP,MAAMC,UAAU,GAAG,OAAOC,OAAP,KAAmB,WAAtC;AAGA,MAAMC,OAAO,GAAG,OAAOC,IAAP,KAAgB,WAAhC;AACA,MAAMC,SAAS,GAAG,OAAOC,MAAP,KAAkB,WAApC;AACA,MAAMC,kBAAkB,GAAG,OAAOC,eAAP,KAA2B,WAAtD,C,CAEA;;AAgBA,SAASC,SAAT,CAAmBC,MAAnB,EAA2B;EACzB,OAAO,OAAOA,MAAP,KAAkB,QAAzB;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,eAAe,SAASC,gBAAT,CAA0BC,KAA1B,EAA8CC,IAA9C,EAA0E;EACvF,IAAID,KAAK,KAAKE,SAAd,EAAyB,MAAM,IAAIC,KAAJ,CAAU,mBAAV,CAAN;EACzB,IAAIF,IAAI,KAAKC,SAAb,EAAwBD,IAAI,GAAG,EAAP;EAExB,IAAIG,GAAJ;EACA,IAAIP,SAAS,CAACG,KAAD,CAAb,EAAsBI,GAAG,GAAIJ,KAAD,CAAmBI,GAAzB,CAAtB,KACK;IACHA,GAAG,GAAGJ,KAAN;IACAA,KAAK,GAAG,EAAR;EACD;EAED,IAAIK,MAAM,GAAGJ,IAAI,CAACI,MAAL,IAAgBL,KAAD,CAAmBK,MAAlC,IAA4C,KAAzD;EACAA,MAAM,GAAGA,MAAM,CAACC,WAAP,EAAT;EACA,MAAMC,KAAK,GAAG,CAAE,GAAEF,MAAO,IAAGD,GAAI,WAAlB,CAAd;EAEA,MAAMI,OAAO,GAAGP,IAAI,CAACO,OAAL,IAAiBR,KAAD,CAAmBQ,OAAnD;;EACA,IAAIA,OAAO,KAAKN,SAAhB,EAA2B;IACzB;IACA,IAAIb,UAAU,IAAImB,OAAO,YAAYlB,OAArC,EAA8C;MAC5C,KAAK,MAAMmB,IAAX,IAAoBD,OAAD,CAAqBE,OAArB,EAAnB,EAAmDH,KAAK,CAACI,IAAN,CAAY,GAAEF,IAAI,CAAC,CAAD,CAAI,KAAIA,IAAI,CAAC,CAAD,CAAI,EAAlC;IACpD,CAFD,MAEO;MACL;MACA,KAAK,MAAMG,GAAX,IAAkBJ,OAAlB,EAA4CD,KAAK,CAACI,IAAN,CAAY,GAAEC,GAAI,KAAIJ,OAAO,CAACI,GAAD,CAAM,EAAnC;IAC7C;EACF;;EAED,MAAMC,IAAI,GAAGZ,IAAI,CAACY,IAAlB;;EACA,IAAIA,IAAI,KAAKX,SAAb,EAAwB;IACtB,IAAI,CAAC,CAAC,KAAD,EAAQ,MAAR,EAAgBY,OAAhB,CAAwBT,MAAxB,CAAL,EAAsC,MAAM,IAAIF,KAAJ,CAAW,qCAAoCE,MAAO,EAAtD,CAAN;IACtC;;IACA,IAAId,OAAO,IAAIsB,IAAI,YAAYrB,IAA/B,EAAqC;MACnCe,KAAK,CAACI,IAAN,CAAW,EAAX;MACAJ,KAAK,CAACI,IAAN,CAAWvB,YAAY,CAACyB,IAAD,CAAvB;IACD,CAHD,MAGO;IACL;IACA,OAAOA,IAAP,KAAgB,QAAhB,IACAA,IAAI,YAAYE,MADhB;IAEA;IACCtB,SAAS,IAAIoB,IAAI,YAAYnB,MAH9B,IAICC,kBAAkB,IAAIkB,IAAI,YAAYjB;IACvC;IAPK,EAQL;MACAW,KAAK,CAACI,IAAN,CAAW,EAAX;MACAJ,KAAK,CAACI,IAAN,CAAWE,IAAI,CAACG,QAAL,EAAX;IACD,CAXM,MAWA,MAAM,IAAIb,KAAJ,CAAU,+CAAV,CAAN;EACR;;EACD,OAAOI,KAAK,CAACU,IAAN,CAAW,MAAX,CAAP;AACD"}