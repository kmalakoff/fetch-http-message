{"version":3,"sources":["index.ts"],"sourcesContent":["import blobToString from './blobToString.js';\n\nexport interface HeadersObject {\n  [key: string]: string;\n}\n\n// https://github.com/node-fetch/node-fetch/blob/main/%40types/index.d.ts\nexport type HeadersInit = Headers | HeadersObject | Record<string, string> | Iterable<readonly [string, string]> | Iterable<Iterable<string>>;\nconst hasHeaders = typeof Headers !== 'undefined';\n\nexport type BodyInit = Blob | Buffer | URLSearchParams | string;\nconst hasBlob = typeof Blob !== 'undefined';\nconst hasBuffer = typeof Buffer !== 'undefined';\nconst hasURLSearchParams = typeof URLSearchParams !== 'undefined';\n\n// export type RequestRedirect = 'error' | 'follow' | 'manual';\nexport interface RequestInit {\n  body?: BodyInit | null;\n  headers?: HeadersInit;\n  method?: string;\n  // redirect?: RequestRedirect;\n}\n\nexport type RequestInfo = string | Request;\nexport interface Request {\n  readonly headers: Headers | HeadersObject;\n  readonly method: string;\n  // readonly redirect: RequestRedirect;\n  readonly url: string;\n}\n\nfunction isRequest(object) {\n  return typeof object === 'object';\n}\n\n/**\n * Generate an http message string using the fetch API\n *\n * @param input Fetch input\n * @param init Fetch init\n * @returns The http message string\n */\nexport default function fetchHttpMessage(input: RequestInfo, init?: RequestInit): string {\n  if (input === undefined) throw new Error('Input is expected');\n  if (init === undefined) init = {};\n\n  let url;\n  if (isRequest(input)) url = (input as Request).url;\n  else {\n    url = input as string;\n    input = {} as Request;\n  }\n\n  let method = init.method || (input as Request).method || 'GET';\n  method = method.toUpperCase();\n  const lines = [`${method} ${url} HTTP/1.1`];\n\n  const headers = init.headers || (input as Request).headers;\n  if (headers !== undefined) {\n    /* c8 ignore start */\n    if (hasHeaders && headers instanceof Headers) {\n      for (const pair of (headers as Headers).entries()) lines.push(`${pair[0]}: ${pair[1]}`);\n    } else {\n      /* c8 ignore stop */\n      for (const key in headers as HeadersObject) lines.push(`${key}: ${headers[key]}`);\n    }\n  }\n\n  const body = init.body;\n  if (body !== undefined) {\n    if (~['GET', 'HEAD'].indexOf(method)) throw new Error(`Option body not valid with method ${method}`);\n    /* c8 ignore start */\n    if (hasBlob && body instanceof Blob) {\n      lines.push('');\n      lines.push(blobToString(body));\n    } else if (\n      /* c8 ignore stop */\n      typeof body === 'string' ||\n      body instanceof String ||\n      /* c8 ignore start */\n      (hasBuffer && body instanceof Buffer) ||\n      (hasURLSearchParams && body instanceof URLSearchParams)\n      /* c8 ignore stop */\n    ) {\n      lines.push('');\n      lines.push(body.toString());\n    } else throw new Error('Option body should be convertible to a string');\n  }\n  return lines.join('\\r\\n');\n}\n"],"names":["blobToString","hasHeaders","Headers","hasBlob","Blob","hasBuffer","Buffer","hasURLSearchParams","URLSearchParams","isRequest","object","fetchHttpMessage","input","init","undefined","Error","url","method","toUpperCase","lines","headers","pair","entries","push","key","body","indexOf","String","toString","join"],"mappings":"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"}