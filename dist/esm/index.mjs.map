{"version":3,"sources":["index.ts"],"sourcesContent":["// @ts-ignore\nimport blobToString from './blobToString.ts';\n\nexport interface HeadersObject {\n  [key: string]: string;\n}\n\n// https://github.com/node-fetch/node-fetch/blob/main/%40types/index.d.ts\nexport type HeadersInit = Headers | HeadersObject | Record<string, string> | Iterable<readonly [string, string]> | Iterable<Iterable<string>>;\nconst hasHeaders = typeof Headers !== 'undefined';\n\nexport type BodyInit = Blob | Buffer | URLSearchParams | string;\nconst hasBlob = typeof Blob !== 'undefined';\nconst hasBuffer = typeof Buffer !== 'undefined';\nconst hasURLSearchParams = typeof URLSearchParams !== 'undefined';\n\n// export type RequestRedirect = 'error' | 'follow' | 'manual';\nexport interface RequestInit {\n  body?: BodyInit | null;\n  headers?: HeadersInit;\n  method?: string;\n  // redirect?: RequestRedirect;\n}\n\nexport type RequestInfo = string | Request;\nexport interface Request {\n  readonly headers: Headers | HeadersObject;\n  readonly method: string;\n  // readonly redirect: RequestRedirect;\n  readonly url: string;\n}\n\nfunction isRequest(object) {\n  return typeof object === 'object';\n}\n\n/**\n * Generate an http message string using the fetch API\n *\n * @param input Fetch input\n * @param init Fetch init\n * @returns The http message string\n */\nexport default function fetchHttpMessage(input: RequestInfo, init?: RequestInit): string {\n  if (input === undefined) throw new Error('Input is expected');\n  if (init === undefined) init = {};\n\n  let url: string;\n  if (isRequest(input)) url = (input as Request).url;\n  else {\n    url = input as string;\n    input = {} as Request;\n  }\n\n  let method = init.method || (input as Request).method || 'GET';\n  method = method.toUpperCase();\n  const lines = [`${method} ${url} HTTP/1.1`];\n\n  const headers = init.headers || (input as Request).headers;\n  if (headers !== undefined) {\n    /* c8 ignore start */\n    if (hasHeaders && headers instanceof Headers) {\n      for (const pair of (headers as Headers).entries()) lines.push(`${pair[0]}: ${pair[1]}`);\n    } else {\n      /* c8 ignore stop */\n      for (const key in headers as HeadersObject) lines.push(`${key}: ${headers[key]}`);\n    }\n  }\n\n  const body = init.body;\n  if (body !== undefined) {\n    if (~['GET', 'HEAD'].indexOf(method)) throw new Error(`Option body not valid with method ${method}`);\n    /* c8 ignore start */\n    if (hasBlob && body instanceof Blob) {\n      lines.push('');\n      lines.push(blobToString(body));\n    } else if (\n      /* c8 ignore stop */\n      typeof body === 'string' ||\n      body instanceof String ||\n      /* c8 ignore start */\n      (hasBuffer && body instanceof Buffer) ||\n      (hasURLSearchParams && body instanceof URLSearchParams)\n      /* c8 ignore stop */\n    ) {\n      lines.push('');\n      lines.push(body.toString());\n    } else throw new Error('Option body should be convertible to a string');\n  }\n  return lines.join('\\r\\n');\n}\n"],"names":["blobToString","hasHeaders","Headers","hasBlob","Blob","hasBuffer","Buffer","hasURLSearchParams","URLSearchParams","isRequest","object","fetchHttpMessage","input","init","undefined","Error","url","method","toUpperCase","lines","headers","pair","entries","push","key","body","indexOf","String","toString","join"],"mappings":"AAAA,aAAa;AACb,OAAOA,kBAAkB,oBAAoB;AAQ7C,MAAMC,aAAa,OAAOC,YAAY;AAGtC,MAAMC,UAAU,OAAOC,SAAS;AAChC,MAAMC,YAAY,OAAOC,WAAW;AACpC,MAAMC,qBAAqB,OAAOC,oBAAoB;AAkBtD,SAASC,UAAUC,MAAM;IACvB,OAAO,OAAOA,WAAW;AAC3B;AAEA;;;;;;CAMC,GACD,eAAe,SAASC,iBAAiBC,KAAkB,EAAEC,IAAkB;IAC7E,IAAID,UAAUE,WAAW,MAAM,IAAIC,MAAM;IACzC,IAAIF,SAASC,WAAWD,OAAO,CAAC;IAEhC,IAAIG;IACJ,IAAIP,UAAUG,QAAQI,MAAM,AAACJ,MAAkBI,GAAG;SAC7C;QACHA,MAAMJ;QACNA,QAAQ,CAAC;IACX;IAEA,IAAIK,SAASJ,KAAKI,MAAM,IAAI,AAACL,MAAkBK,MAAM,IAAI;IACzDA,SAASA,OAAOC,WAAW;IAC3B,MAAMC,QAAQ;QAAC,CAAC,EAAEF,OAAO,CAAC,EAAED,IAAI,SAAS,CAAC;KAAC;IAE3C,MAAMI,UAAUP,KAAKO,OAAO,IAAI,AAACR,MAAkBQ,OAAO;IAC1D,IAAIA,YAAYN,WAAW;QACzB,mBAAmB,GACnB,IAAIb,cAAcmB,mBAAmBlB,SAAS;YAC5C,KAAK,MAAMmB,QAAQ,AAACD,QAAoBE,OAAO,GAAIH,MAAMI,IAAI,CAAC,CAAC,EAAEF,IAAI,CAAC,EAAE,CAAC,EAAE,EAAEA,IAAI,CAAC,EAAE,CAAC,CAAC;QACxF,OAAO;YACL,kBAAkB,GAClB,IAAK,MAAMG,OAAOJ,QAA0BD,MAAMI,IAAI,CAAC,CAAC,EAAEC,IAAI,EAAE,EAAEJ,OAAO,CAACI,IAAI,CAAC,CAAC;QAClF;IACF;IAEA,MAAMC,OAAOZ,KAAKY,IAAI;IACtB,IAAIA,SAASX,WAAW;QACtB,IAAI,CAAC;YAAC;YAAO;SAAO,CAACY,OAAO,CAACT,SAAS,MAAM,IAAIF,MAAM,CAAC,kCAAkC,EAAEE,OAAO,CAAC;QACnG,mBAAmB,GACnB,IAAId,WAAWsB,gBAAgBrB,MAAM;YACnCe,MAAMI,IAAI,CAAC;YACXJ,MAAMI,IAAI,CAACvB,aAAayB;QAC1B,OAAO,IACL,kBAAkB,GAClB,OAAOA,SAAS,YAChBA,gBAAgBE,UAChB,mBAAmB,GAClBtB,aAAaoB,gBAAgBnB,UAC7BC,sBAAsBkB,gBAAgBjB,iBAEvC;YACAW,MAAMI,IAAI,CAAC;YACXJ,MAAMI,IAAI,CAACE,KAAKG,QAAQ;QAC1B,OAAO,MAAM,IAAIb,MAAM;IACzB;IACA,OAAOI,MAAMU,IAAI,CAAC;AACpB"}